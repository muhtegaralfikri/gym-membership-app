generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  id                Int              @id @default(autoincrement())
  name              String
  email             String           @unique
  password          String
  phone             String?
  isActive          Boolean          @default(true)
  roleId            Int
  createdAt         DateTime         @default(now())
  updatedAt         DateTime         @updatedAt
  adminLogs         AdminLog[]
  classBookings     ClassBooking[]
  updatedGymClasses GymClass[]       @relation("GymClassUpdatedBy")
  sessionsAsMember  PTSession[]      @relation("MemberSessions")
  sessionsAsTrainer PTSession[]      @relation("TrainerSessions")
  trainerProfile    TrainerProfile?
  transactions      Transaction[]
  role              Role             @relation(fields: [roleId], references: [id])
  memberships       UserMembership[]

  @@index([roleId], map: "User_roleId_fkey")
}

model Role {
  id    Int    @id @default(autoincrement())
  name  String @unique
  users User[]
}

model Package {
  id              Int              @id @default(autoincrement())
  name            String           @unique
  description     String?
  features        String?          @db.LongText
  price           Decimal          @db.Decimal(10, 2)
  durationDays    Int
  isActive        Boolean          @default(true)
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  bundleItems     String?          @db.LongText
  promoExpiresAt  DateTime?
  promoPrice      Decimal?         @db.Decimal(10, 2)
  ptSessionsQuota Int              @default(0)
  promoCodes      PromoCode[]
  transactions    Transaction[]
  memberships     UserMembership[]
}

model Transaction {
  id                     Int             @id @default(autoincrement())
  orderId                String          @unique
  amount                 Decimal         @db.Decimal(10, 2)
  status                 PaymentStatus   @default(pending)
  paymentGateway         String?
  paymentGatewayResponse String?         @db.LongText
  createdAt              DateTime        @default(now())
  updatedAt              DateTime        @updatedAt
  userId                 Int
  packageId              Int
  discountAmount         Decimal         @default(0.00) @db.Decimal(10, 2)
  promoCodeId            Int?
  package                Package         @relation(fields: [packageId], references: [id])
  promoCode              PromoCode?      @relation(fields: [promoCodeId], references: [id])
  user                   User            @relation(fields: [userId], references: [id])
  membership             UserMembership?

  @@index([packageId], map: "Transaction_packageId_fkey")
  @@index([promoCodeId], map: "Transaction_promoCodeId_fkey")
  @@index([userId], map: "Transaction_userId_fkey")
}

model UserMembership {
  id            Int              @id @default(autoincrement())
  startDate     DateTime
  endDate       DateTime
  status        MembershipStatus @default(upcoming)
  userId        Int
  packageId     Int
  transactionId Int              @unique
  package       Package          @relation(fields: [packageId], references: [id])
  transaction   Transaction      @relation(fields: [transactionId], references: [id])
  user          User             @relation(fields: [userId], references: [id])

  @@index([packageId], map: "UserMembership_packageId_fkey")
  @@index([userId], map: "UserMembership_userId_fkey")
}

model TrainerProfile {
  id             Int                   @id @default(autoincrement())
  userId         Int                   @unique
  specialties    String
  bio            String
  rate           Decimal?              @db.Decimal(10, 2)
  rating         Float                 @default(5)
  availabilities TrainerAvailability[]
  user           User                  @relation(fields: [userId], references: [id])
}

model TrainerAvailability {
  id        Int            @id @default(autoincrement())
  trainerId Int
  dayOfWeek Int
  startTime String
  endTime   String
  trainer   TrainerProfile @relation(fields: [trainerId], references: [id])

  @@index([trainerId], map: "TrainerAvailability_trainerId_fkey")
}

model PTSession {
  id              Int             @id @default(autoincrement())
  trainerId       Int
  memberId        Int
  scheduledAt     DateTime
  durationMinutes Int             @default(60)
  status          PTSessionStatus @default(BOOKED)
  notes           String?
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt
<<<<<<< Updated upstream

  @@unique([trainerId, scheduledAt])
=======
  member          User            @relation("MemberSessions", fields: [memberId], references: [id])
  trainer         User            @relation("TrainerSessions", fields: [trainerId], references: [id])

  @@index([memberId], map: "PTSession_memberId_fkey")
  @@index([trainerId], map: "PTSession_trainerId_fkey")
>>>>>>> Stashed changes
}

model GymClass {
  id          Int            @id @default(autoincrement())
  title       String
  description String?
  instructor  String?
  location    String?
  startTime   DateTime
  endTime     DateTime
  capacity    Int            @default(20)
  createdAt   DateTime       @default(now())
  updatedAt   DateTime       @updatedAt
  updatedById Int?
  bookings    ClassBooking[]
  updatedBy   User?          @relation("GymClassUpdatedBy", fields: [updatedById], references: [id])

  @@index([updatedById], map: "GymClass_updatedById_fkey")
}

model ClassBooking {
  id            Int           @id @default(autoincrement())
  status        BookingStatus @default(booked)
  checkedInAt   DateTime?
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  userId        Int
  classId       Int
  checkinSecret String
  gymClass      GymClass      @relation(fields: [classId], references: [id])
  user          User          @relation(fields: [userId], references: [id])

  @@unique([userId, classId])
  @@index([classId], map: "ClassBooking_classId_fkey")
}

model AdminLog {
  id        Int      @id @default(autoincrement())
  entity    String
  entityId  Int?
  action    String
  details   String?  @db.LongText
  createdAt DateTime @default(now())
  adminId   Int?
  admin     User?    @relation(fields: [adminId], references: [id])

  @@index([adminId], map: "AdminLog_adminId_fkey")
}

model PromoCode {
  id           Int               @id @default(autoincrement())
  code         String            @unique
  description  String?
  discountType PromoDiscountType
  value        Decimal           @db.Decimal(10, 2)
  maxDiscount  Decimal?          @db.Decimal(10, 2)
  minAmount    Decimal?          @db.Decimal(10, 2)
  startsAt     DateTime?
  endsAt       DateTime?
  usageLimit   Int?
  usedCount    Int               @default(0)
  isActive     Boolean           @default(true)
  packageId    Int?
  createdAt    DateTime          @default(now())
  updatedAt    DateTime          @updatedAt
  package      Package?          @relation(fields: [packageId], references: [id])
  transactions Transaction[]

  @@index([packageId], map: "PromoCode_packageId_fkey")
}

enum PaymentStatus {
  pending
  success
  failed
}

enum MembershipStatus {
  upcoming
  active
  expired
}

enum PromoDiscountType {
  PERCENT
  FIXED
}

enum BookingStatus {
  booked
  checked_in
  cancelled
}

enum PTSessionStatus {
  BOOKED
  COMPLETED
  CANCELLED
  NOSHOW
}
